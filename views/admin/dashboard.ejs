<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Admin Dashboard</title>

  <!-- Bootstrap 5 -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

  <!-- FontAwesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

  <style>
    body {
      background: #f4f7fc;
    }

    .stat-card {
      background: #fff;
      border-radius: 20px;
      padding: 22px;
      display: flex;
      align-items: center;
      box-shadow: 0 6px 20px rgba(0, 0, 0, 0.06);
      height: 120px;
    }

    .icon-circle {
      width: 55px;
      height: 55px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      margin-right: 15px;
      background: #e6f0ff;
      font-size: 24px;
      color: #0d6efd;
    }

    .stat-title {
      font-size: 14px;
      color: #6b7280;
    }

    .stat-value {
      font-size: 26px;
      font-weight: 700;
    }

    .chart-box {
      background: #fff;
      border-radius: 25px;
      padding: 25px;
      box-shadow: 0 6px 20px rgba(0, 0, 0, 0.06);
    }

    .filter-box {
      background: #fff;
      padding: 15px 20px;
      border-radius: 15px;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.05);
      margin-bottom: 25px;
    }

    .top-card {
      background: #ffffff;
      border-radius: 18px;
      padding: 20px;
      border: 1px solid rgba(13, 110, 253, 0.20);
      box-shadow: 0 6px 14px rgba(13, 110, 253, 0.10);
      transition: 0.2s;
    }

    .top-card:hover {
      transform: translateY(-3px);
      box-shadow: 0 12px 24px rgba(13, 110, 253, 0.18);
    }

    .top-item {
      padding: 8px 0;
      border-bottom: 1px dashed #d9e6ff;
    }

    .top-item:last-child {
      border-bottom: none;
    }

    .top-title {
      font-weight: 700;
      color: #0d6efd;
      margin-bottom: 12px;
    }
  </style>

</head>

<body>

  <%- include("../partials/admin/header") %>

  <div class="d-flex">
    <%- include("../partials/admin/sidebar") %>

    <main class="p-4 w-100">

      <h3 class="fw-bold mb-4">Dashboard</h3>

      <!-- TOP CARDS -->
      <div class="row g-4 mb-4">

        <div class="col-lg-3 col-md-6">
          <div class="stat-card">
            <div class="icon-circle"><i class="fa-solid fa-users"></i></div>
            <div>
              <div class="stat-title">Total Customers</div>
              <div class="stat-value"><%= totalCustomers %></div>
            </div>
          </div>
        </div>

        <div class="col-lg-3 col-md-6">
          <div class="stat-card">
            <div class="icon-circle"><i class="fa-solid fa-bag-shopping"></i></div>
            <div>
              <div class="stat-title">Total Orders</div>
              <div class="stat-value"><%= totalOrders %></div>
            </div>
          </div>
        </div>

        <div class="col-lg-3 col-md-6">
          <div class="stat-card">
            <div class="icon-circle"><i class="fa-solid fa-indian-rupee-sign"></i></div>
            <div>
              <div class="stat-title">Total Sales</div>
              <div class="stat-value">â‚¹<%= totalSales.toLocaleString() %></div>
            </div>
          </div>
        </div>

        <div class="col-lg-3 col-md-6">
          <div class="stat-card">
            <div class="icon-circle"><i class="fa-solid fa-clock"></i></div>
            <div>
              <div class="stat-title">Pending Orders</div>
              <div class="stat-value"><%= totalPending %></div>
            </div>
          </div>
        </div>

      </div>

      <!-- FILTER SECTION -->
      <div class="filter-box">

        <form method="GET" action="/admin/dashboard" class="row gy-2 gx-3 align-items-center">

          <!-- Filter dropdown -->
          <div class="col-md-3">
            <select id="filterType" class="form-select" name="type">
              <option value="">Select Filter</option>
              <option value="day" <%= type === "day" ? "selected" : "" %>>Day</option>
              <option value="week" <%= type === "week" ? "selected" : "" %>>Week</option>
              <option value="month" <%= type === "month" ? "selected" : "" %>>Month</option>
              <option value="year" <%= type === "year" ? "selected" : "" %>>Year</option>
              <option value="custom" <%= type === "custom" ? "selected" : "" %>>Custom</option>
            </select>
          </div>

          <!-- Custom date from -->
          <div class="col-md-3 custom-date d-none">
            <input type="date" class="form-control" name="from" value="<%= from || '' %>">
          </div>

          <!-- Custom date to -->
          <div class="col-md-3 custom-date d-none">
            <input type="date" class="form-control" name="to" value="<%= to || '' %>">
          </div>

          <div class="col-md-3">
            <button class="btn btn-primary w-100">Apply</button>
          </div>

        </form>
      </div>

      <script>
        const filterSelect = document.getElementById("filterType");
        const customFields = document.querySelectorAll(".custom-date");

        function toggleCustomDates() {
          if (filterSelect.value === "custom") {
            customFields.forEach(el => el.classList.remove("d-none"));
          } else {
            customFields.forEach(el => el.classList.add("d-none"));
          }
        }

        filterSelect.addEventListener("change", toggleCustomDates);
        toggleCustomDates();
      </script>

      <!-- SALES CHART -->
      <div class="chart-box mb-5">
        <h5 class="fw-semibold mb-3">Sales Activity</h5>
        <canvas id="salesBarChart" height="120"></canvas>
      </div>

      <!-- TOP 3 SECTION -->
      <div class="row g-4">

        <div class="col-md-4">
          <div class="top-card">
            <h6 class="top-title"><i class="fa-solid fa-box"></i> Top 3 Products</h6>
            <% topProducts.forEach(p => { %>
              <div class="d-flex justify-content-between top-item">
                <span><%= p._id %></span>
                <span class="fw-bold text-primary"><%= p.totalQty %> sold</span>
              </div>
            <% }) %>
          </div>
        </div>

        <div class="col-md-4">
          <div class="top-card">
            <h6 class="top-title"><i class="fa-solid fa-layer-group"></i> Top 3 Categories</h6>
            <% topCategories.forEach(c => { %>
              <div class="d-flex justify-content-between top-item">
                <span><%= c._id %></span>
                <span class="fw-bold text-primary"><%= c.totalQty %> sold</span>
              </div>
            <% }) %>
          </div>
        </div>

        <div class="col-md-4">
          <div class="top-card">
            <h6 class="top-title"><i class="fa-solid fa-tags"></i> Top 3 Subcategories</h6>
            <% topSubcategories.forEach(s => { %>
              <div class="d-flex justify-content-between top-item">
                <span><%= s._id %></span>
                <span class="fw-bold text-primary"><%= s.totalQty %> sold</span>
              </div>
            <% }) %>
          </div>
        </div>

      </div>

    </main>
  </div>

  <script>
    const ctx = document.getElementById("salesBarChart").getContext("2d");

    new Chart(ctx, {
      type: "bar",
      data: {
        labels: <%- JSON.stringify(chartLabels) %>,
        datasets: [{
          data: <%- JSON.stringify(chartData) %>,
          backgroundColor: "#0d6efd",
          borderRadius: 8,
          barThickness: 28
        }]
      },
      options: {
        plugins: { legend: { display: false } },
        scales: {
          x: { grid: { display: false } },
          y: { grid: { display: false }, beginAtZero: true }
        }
      }
    });
  </script>

</body>
</html>
