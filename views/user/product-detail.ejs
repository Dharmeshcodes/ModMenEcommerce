<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title><%= product.name %> - MODMEN</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"/>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/easyzoom@2.5.0/css/easyzoom.css">
  <style>
    /* Your original CSS here (no changes) */
    :root {
      --main-text: #171717;
      --text-muted: #666;
      --star: #FFBB36;
      --main-accent: #101010;
      --main-bg: #fff;
    }
    body {
      font-family: 'Inter', Arial, sans-serif;
      background: var(--main-bg);
      color: var(--main-text);
    }
    .container { max-width: 1380px; }
    /* MAIN PRODUCT AREA */
    .main-row {
      display: flex;
      align-items: flex-start;
      gap: 32px;
      margin-top: 40px;
    }
    .thumbs-list {
      display: flex;
      flex-direction: column;
      gap: 16px;
      min-width: 104px;
    }
    .pd-thumb {
      width: 90px;
      height: 110px;
      object-fit: cover;
      border-radius: 8px;
      border: 2px solid #f1f1f1;
      background: #fff;
      cursor: pointer;
      transition: border-color 0.15s;
    }
    .pd-thumb.active { border-color: var(--main-text);}
    .main-img-wrap { min-width: 340px; flex: 1 1 38vw; display: flex; justify-content: center; align-items: center;}
    .main-img {
      width: 98%;
      max-width: 500px;
      height: 570px;
      object-fit: cover;
      border-radius: 13px;
      border: 1px solid #e1e1e3;
      background: #fafafe;
      box-shadow: 0 0 14px rgba(60,60,60,0.06);
    }
    .pd-info-area {
      width: 470px;
      max-width: 92vw;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      padding-left: 16px;
    }
    .product-title {
      font-family: 'Poppins', serif;
      font-size: 2.35rem;
      font-weight: 700;
      margin-bottom: 6px;
      line-height: 1.14;
      letter-spacing: 0.025em;
    }
    .star-section {
      display: flex;
      align-items: center;
      margin-bottom: 4px;
    }
    .star-rating i { color: var(--star); font-size: 1.65em; margin-right: 3px;}
    .rating-score { font-size: 1.17em; font-weight: 500; margin-left: 7px; color: #232323;}
    .product-price {
      font-size: 2.75rem;
      font-family: 'Poppins', sans-serif;
      font-weight: 700;
      color: var(--main-accent);
      letter-spacing: 0.02em;
      margin-top: 1px;
      margin-bottom: 20px;
    }
    .desc {
      font-size: 1.08rem;
      color: #707070;
      margin-bottom: 22px;
      letter-spacing: 0.01em;
      line-height: 1.6;
      font-family: 'Inter', sans-serif;
    }
    .coupons-block {
      font-size: 0.97rem;
      color: #939393;
      margin-left: 22px;
      margin-bottom: 28px;
      margin-top: 3px;
      display: flex;
      flex-direction: column;
      gap: 6px;
    }
    .coupon-box {
      border: none;
      background: none;
      font-size: 1.01em;
      display: flex;
      align-items: flex-start;
      color: var(--text-muted);
      gap: 8px;
      padding: 0;
    }
    .coupon-ico {
      color: #d6bb8a;
      font-size: 1.12em;
      margin-top: 2.5px;
      flex-shrink: 0;
    }
    .coupon-bold { color: #18191a; font-weight: 600; font-family: 'Poppins'; }
    .coupon-code { background: #efe5cd; font-family: monospace; padding: 2px 10px; color: #ae8b0c; border-radius: 6px; margin-left: 4px;}
    .size-row, .color-row {
      display: flex;
      gap: 11px;
      margin: 8px 0 29px 0;
    }
    .size-selector-label,.color-label {
      font-size: 1.07em;
      font-weight: 600;
      color: #3c3c3c;
      margin-bottom: 5px;
      margin-top: 10px;
    }
    .size-pill,
    .color-pill  {
      border-radius: 50px;
      border: 1px solid #ececec;
      background: #f3f1ef;
      font-size: 1.05em;
      padding: 8px 28px;
      font-weight: 600;
      color: #333;
      cursor: pointer;
      transition: background 0.2s, color 0.2s, border 0.18s;
      margin-bottom: 2px;
    }
    .size-pill.active,
    .color-pill.active  {
      background: #111;
      color: #fff;
      border-color: #111;
    }
    .cart-row {
      display: flex;
      justify-content: flex-start;
      align-items: center;
      margin-top: 40px;
      gap: 9px;
    }
    .cart-btn {
      padding: 11px 110px;
      border-radius: 30px;
      border: none;
      font-size: 1.17em;
      font-weight: 700;
      background: #111;
      color: #fff;
      letter-spacing: 0.03em;
      transition: background 0.15s;
      margin-right: 0;
    }
    .cart-btn:hover { background: #333; color: #fff;}
    .wishlist-btn {
      background: #fff;
      color: #111;
      border: 2px solid #101010;
      font-size: 1.43em;
      border-radius: 50%;
      width: 50px; height: 50px;
      display: flex; align-items: center; justify-content: center;
      margin-left: 6px;
      transition: background 0.14s, border 0.13s;
    }
    .wishlist-btn:hover { background: #efefee; border-color: #555; color: #111;}
    /* Tabs */
    .tab-nav {
      width: 100%;
      border-bottom: 1.5px solid #c8c8c8;
      display: flex;
      gap: 34px;
      margin: 56px 0 0 0;
    }
    .tab-nav .tab {
      flex: 0 0 auto;
      cursor: pointer;
      padding: 15px 2px 12px 2px;
      font-size: 1.15rem;
      font-family: 'Poppins',sans-serif;
      color: #888;
      border-bottom: 2.5px solid transparent;
      transition: color 0.15s, border-color 0.19s;
      letter-spacing: 0.015em;
      background: none;
      outline: none;
      font-weight: 600;
    }
    .tab-nav .tab.active {
      color: #101010;
      border-color: #101010;
      font-weight: 700;
      background: none;
    }
    .tab-pane { display: none; }
    .tab-pane.active { display: block; }
    /* Product Details Section */
    .pd-details-block { margin: 36px 0 22px 0;}
    .pd-details-block h5 {
      font-size: 1.15rem;
      font-weight: 700;
      font-family: 'Poppins', sans-serif;
      margin-bottom: 8px;
    }
    .pd-details-block span,
    .pd-details-block p {
      font-weight: 400;
      color: #444;
      font-size: 1.045em;
      margin-bottom: 8px;
      display: block;
      line-height: 1.6;
    }
    .pd-details-note {
      color: #6d6d6d;
      font-size: 1.01em;
      margin: 24px 0;
      line-height: 1.6;
      font-style: italic;
    }
    /* Reviews & Ratings Tab */
    .review-controls-row {
      margin: 36px 0 16px 0;
      display: flex; justify-content: space-between; align-items: center;
      gap: 12px;
      flex-wrap: wrap;
    }
    .reviews-heading {
      font-size: 1.15rem;
      font-weight: 700;
      color: #101010;
      font-family: 'Poppins',sans-serif;
    }
    .review-sort-select {
      border-radius: 6px;
      border: 1px solid #e0e0e0;
      padding: 5px 24px 5px 14px;
      font-size: 1em;
      margin-right: 11px;
      color: #443;
      font-weight: 600;
    }
    .write-review-btn {
      padding: 6px 22px;
      border-radius: 28px;
      background: #111;
      color: #fff;
      font-weight: 600;
      border: none;
      font-size: 1.09em;
      font-family: 'Inter',sans-serif;
      margin-left: 9px;
      transition: background 0.17s;
    }
    .write-review-btn:hover { background: #222;}
    .reviews-grid {
      width: 100%;
      display: grid;
      grid-template-columns: repeat(2,1fr);
      gap: 26px 22px;
      margin-bottom: 30px;
    }
    .review-card {
      background: #fff;
      border: 1.3px solid #ededed;
      border-radius: 13px;
      box-shadow: 0 2px 8px #e5e5e5aa;
      padding: 27px 23px 21px 23px;
      display: flex; flex-direction: column; gap: 5px;
      min-height: 90px;
    }
    .review-author {
      font-weight: 700;
      color: #111;
      font-size: 1.07em;
      font-family: 'Poppins',sans-serif;
      display: flex; align-items: center; gap: 7px;
    }
    .verify-badge { color: #16c06d; margin-bottom: 1px; font-size: 1em;}
    .review-rating i {
      color: var(--star);
      font-size: 1.2em;
      margin-right: 1px;
    }
    .review-content {
      font-size: 1.045em;
      color: #474747;
      margin-top: 4px;
      font-family: 'Inter',sans-serif;
    }
    .review-date { color: #909090; font-size: .97em; }
    /* Pagination */
    .pagination-row { display: flex; align-items: center; justify-content: center; gap: 13px; margin: 19px 0 0 0;}
    .pagination-circle {
      width: 32px;
      height: 32px;
      border-radius: 50%;
      background: #f2f2f2;
      display: flex; align-items: center; justify-content: center;
      font-weight: bold; color: #444; font-size: 1.12em;
      cursor: pointer;
      border: none;
      outline: none;
      transition: background .15s, color .13s;
    }
    .pagination-circle.active { background: #101010; color: #fff;}
    .pagination-row .dots { font-size:1.39em;padding: 0 5px;}
    /* Write Review */
    .write-review-section { background: #f7f7fa; border-radius: 13px; padding: 32px 25px 21px 25px; max-width: 600px; margin: 28px auto 52px auto; box-shadow: 0 2px 12px #dedede56;}
    .write-review-section label { font-weight: 600; color: #212121; font-size: 1.07em;}
    .write-review-stars { font-size: 2em; color: #b2b2b2; margin-bottom: 9px; user-select: none; cursor: pointer;}
    .write-review-stars .fas { color: #FFBB36;}
    .write-review-section textarea { resize: vertical; font-size: 1.05em; border-radius: 8px; border: 1px solid #dadada;}
    .write-review-section button { background: #101010; color:#fff; border-radius: 23px; font-weight: 700; font-size:1.075em; padding: 8px 39px; border:none; margin-top: 11px; transition: background 0.19s;}
    .write-review-section button:hover { background: #101010ee;}
    /* "YOU MAY ALSO LIKE" */
    .you-may-like-row { margin: 48px 0; }
    .you-may-like-title { font-family:'Poppins',serif; font-size:1.19rem; font-weight:700; color:#161616; margin-bottom:21px;}
    .like-gallery-row { display:grid; grid-template-columns: repeat(4,1fr); gap: 20px 31px; }
    .like-card { background: #fff; border-radius:9px; border: 1.4px solid #ededed; box-shadow: 0 2px 13px #edeaea6c; padding: 9px 10px 18px 10px; text-align:center; }
    .like-card img { width: 97%; border-radius: 7px; aspect-ratio: 1/1.16; object-fit:cover;}
    .like-title { font-size: 1.13em; font-weight: 600; color: #232323; margin-top: 11px; margin-bottom:3px;}
    .like-price { font-weight: 500; color: #555; font-size: 1.07em; }
    .like-stars { color: #febc14; font-size: 1em; margin-top: 4px;}
    @media (max-width:1200px) { .main-row{flex-direction:column}.reviews-grid{grid-template-columns:1fr}.like-gallery-row{grid-template-columns:1fr 1fr;} }
    @media (max-width:767px) { .main-row{flex-direction:column}.product-title{font-size:1.5rem}.reviews-grid,.like-gallery-row{grid-template-columns:1fr}.cart-btn{padding:10px 0;width:100%}}
  </style>
</head>
<body>
<%- include('../partials/user/header.ejs', { user: user }) %>
<div class="container">
<!-- MAIN ROW: IMAGE + INFO -->
<div class="row mb-4 pb-2 align-items-stretch" style="min-height:580px;">
  <!-- Thumbnails -->
  <div class="col-auto d-flex flex-column justify-content-center pe-0">
    <% (product.images || []).forEach(function(img, idx) { %>
      <img src="<%= img.url %>" class="pd-thumb mb-2 <% if (idx === 0) { %>active<% } %>" alt="thumb<%= idx+1 %>"
        style="width:90px;height:108px;object-fit:cover;border-radius:8px;border:2px solid #f1f1f1;cursor:pointer;"
        onclick="showImg(<%= idx %>)">
    <% }) %>
  </div>
  <!-- Main Image -->
  <div class="col-md-6 d-flex justify-content-center align-items-center px-0">
    <div class="easyzoom easyzoom--overlay w-100 h-100 d-flex justify-content-center align-items-center">
      <a href="<%= product.images && product.images[0] ? product.images[0].url : '/user/images/no-image.png' %>" id="mainImageLink">
        <img id="mainImage" class="main-img" style="max-width:420px;width:100%;height:520px;object-fit:cover;border-radius:13px;border:1px solid #e1e1e3;background:#fafafe;box-shadow:0 0 14px rgba(60,60,60,0.06);"
          src="<%= product.images && product.images[0] ? product.images[0].url : '/user/images/no-image.png' %>"
          alt="<%= product.name %>"/>
      </a>
    </div>
  </div>
  <!-- Product Info Section -->
  <div class="col-md-5 d-flex flex-column justify-content-center pt-2 px-4">
    <h1 class="mb-1" style="font-family: 'Poppins', serif; font-size:2.1rem;font-weight:700;"><%= product.name %></h1>
    <div class="mb-2 d-flex align-items-center gap-2" style="margin-bottom:10px;">
      <span>
        <% for(let i=1; i<=5; i++){ %>
          <i class="<%= i <= Math.floor(product.averageRating||4.5) ? 'fas fa-star' : (i-0.5 == product.averageRating ? 'fas fa-star-half-alt' : 'far fa-star') %>" style="color:#FFBB36;font-size:1.34em;margin-right:1px;"></i>
        <% } %>
      </span>
      <span style="font-size:1.08em;font-weight:500;color:#454545">
        <%= (product.averageRating !== undefined && product.averageRating !== null) ? product.averageRating.toFixed(1) : '4.5' %>/5
      </span>
    </div>
    <div class="product-price mb-1" style="font-size:2.2rem;font-weight:700;color:#222;">
      ₹ <span id="salePrice"><%= product.variants && product.variants[0] ? product.variants[0].salePrice.toFixed(2) : product.price %></span>
    </div>
    <div class="desc" style="font-size:1.08rem;color:#707070;margin-bottom:18px;"><%= product.description %></div>
      
    <!-- Coupons -->
    <div class="coupons-block mb-3 ps-3" style="color:#666;font-size:1.01rem;">
      <% (product.coupons || [
        {price:"1,189", discount:"10", minPurchase:"-", code:"APP10"},
        {price:"1,119", discount:"20", minPurchase:"4599", code:"FLAT20"},
        {price:"1,189", discount:"15", minPurchase:"2999", code:"FLAT15"},
        {price:"1,259", discount:"10", minPurchase:"1999", code:"FLAT10"}
      ]).forEach(function(cpn) { %>
        <div class="coupon-box d-flex align-items-center mb-2">
          <span class="coupon-ico"><i class="fa-regular fa-circle-check"></i></span>
          <span>Get this for <span class="coupon-bold" style="font-weight:600;color:#18191a;">INR <%= cpn.price %></span>
          Flat <%= cpn.discount %>% Off<% if (cpn.minPurchase!=="-") { %> on minimum purchase of <%= cpn.minPurchase %>/<% } %>
          <span class="coupon-code" style="background:#efe5cd;font-family:monospace;padding:2px 12px;color:#ae8b0c;border-radius:6px;margin-left:6px;"><%= cpn.code %></span></span>
        </div>
      <% }) %>
    </div>


    <!-- Size selector pills (from product.variants) -->
    <div class="size-selector-label mb-2" style="font-weight:600;">Choose Size</div>
    <div class="size-row mb-4 d-flex flex-wrap gap-2">
      <% (product.variants || []).forEach(function(variant, i) { %>
        <span class="size-pill <%= i===0 ? 'active' : '' %>"
          style="border-radius:50px;border:1px solid #ececec;background:#f3f1ef;font-size:1.05em;padding:9px 28px;font-weight:600;color:#333;cursor:pointer;transition:background .2s,border .2s;"
          onclick="selectSize('<%= variant.size %>', <%= i %>)">
          <%= variant.size %>
        </span>
      <% }); %>
    </div>
    <!-- Color pill, only one color according to logic -->
    <div class="color-label mb-2" style="font-weight:600;">Choose color</div>
    <div class="color-row mb-4 d-flex gap-2">
      <% if (product.variants && product.variants[0]) { %>
        <span class="color-pill active"
          style="border-radius:50px;border:1px solid #ececec;background:#f3f1ef;font-size:1.05em;padding:9px 28px;font-weight:600;color:#333;user-select:none;">
          <%= product.variants[0].color %>
        </span>
      <% } %>
    </div>

    <!-- Cart & Wishlist -->
    <div class="cart-row d-flex gap-2 align-items-center mt-3 mb-0">
      <% if (variant && variant.variantQuantity > 0) { %>
          <button id="stockBtn" class="btn btn-primary" disabled>In Stock</button>
        <% } else { %>
          <button id="stockBtn" class="btn btn-secondary" disabled>Out of Stock</button>
        <% } %>

      <button class="cart-btn" style="padding:12px 90px;border-radius:30px;font-weight:700;font-size:1.15em;background:#111;color:#fff;border:none;">Add to Cart</button>
      <button class="wishlist-btn" title="Wishlist" style="background:#fff;color:#111;border:2px solid #101010;font-size:1.43em;border-radius:50%;width:50px;height:50px;display:flex;align-items:center;justify-content:center;margin-left:6px;"><i class="far fa-heart"></i></button>
    </div>
  </div>
</div>

 <!-- TABS -->
 <div class="tab-nav">
   <div class="tab active" id="productDetailsTab" onclick="switchTab('details')">Product Details</div>
   <div class="tab" id="ratingsTab" onclick="switchTab('reviews')">Rating & Reviews</div>
 </div>

 <!-- PRODUCT DETAILS TAB -->
 <div id="tab-details" class="tab-pane active">
   <div class="pd-details-block"><h5>Description</h5><span><%= product.description %></span></div>
   <div class="pd-details-block"><h5>Size & Fit</h5><span><%= (product.fit || 'Slim Fit') %></span></div>
   <div class="pd-details-block"><h5>Wash Care</h5><span><%= product.washCare || 'Machine Wash' %></span></div>
   <div class="pd-details-block"><h5>Specifications</h5>
     <span><%= product.specification1 || 'Casual, College' %></span>
     <span><%= product.specification2 || 'Checks' %></span>
     <span><%= product.specification3 || 'Spread' %></span>
     <span><%= product.specification4 || '45.4% Cotton, 44.3% Polyester, 6.3% Viscose' %></span>
     <span><%= product.specification5 || 'Full Sleeve' %></span>
   </div>
   <div class="pd-details-note">
     Note : The actual colour of the product may vary slightly due to photographic lighting sources or your device.
   </div>
 </div>

 <!-- RATING & REVIEWS TAB -->
 <div id="tab-reviews" class="tab-pane">
   <div class="review-controls-row">
     <div class="reviews-heading">All Reviews</div>
     <div class="d-flex align-items-center">
       <select class="review-sort-select"><option>Latest</option><option>Highest Rated</option><option>Lowest Rated</option></select>
       <button class="write-review-btn">Write a Review</button>
     </div>
   </div>
   <div class="reviews-grid">
     <% dummyReviews.forEach(function(review) { %>
       <div class="review-card">
         <div class="review-author"><%= review.author %> <span class="verify-badge"><i class="fa-solid fa-circle-check"></i></span></div>
         <div class="review-rating">
           <% for(var s=1; s<=5; s++) { %>
             <% if(s <= review.rating) { %>
               <i class="fas fa-star"></i>
             <% } else { %>
               <i class="far fa-star"></i>
             <% } %>
           <% } %>
         </div>
         <div class="review-content"><%= review.content %></div>
         <div class="review-date">Posted on <%= review.date %></div>
       </div>
     <% }) %>
   </div>
   <div class="pagination-row">
     <button class="pagination-circle active">1</button>
     <button class="pagination-circle">2</button>
     <button class="pagination-circle">3</button>
     <span class="dots">...</span>
     <button class="pagination-circle">5</button>
   </div>
   <div class="write-review-section">
     <label>Write a Review</label>
     <div class="write-review-stars" id="star-rating">
       <i class="far fa-star" data-star="1"></i>
       <i class="far fa-star" data-star="2"></i>
       <i class="far fa-star" data-star="3"></i>
       <i class="far fa-star" data-star="4"></i>
       <i class="far fa-star" data-star="5"></i>
     </div>
     <textarea class="form-control mb-3" rows="3" placeholder="Share what you like or dislike about the product..."></textarea>
     <button>Submit Review</button>
   </div>
 </div>

 <!-- YOU MAY ALSO LIKE -->
 <div class="you-may-like-row">
   <div class="you-may-like-title">YOU MAY ALSO LIKE</div>
   <div class="like-gallery-row">
     <% (alsoLikeProducts || []).slice(0,4).forEach(function(item) { %>
       <div class="like-card">
         <img src="<%= item.images && item.images[0] ? item.images[0].url : '/user/images/no-image.png' %>" alt="Also like product"/>
         <div class="like-title">
           <a href="/product/<%= item._id %>" class="text-decoration-none text-dark"><%= item.name %></a>
         </div>
         <div class="like-price">₹ <%= Math.round(item.finalPrice) %>.00</div>
         <div class="like-stars">
           <i class="fas fa-star"></i><i class="fas fa-star"></i><i class="fas fa-star"></i>
           <i class="fas fa-star"></i><i class="fas fa-star-half-alt"></i>
         </div>
       </div>
     <% }) %>
   </div>
 </div>
</div>

<%- include('../partials/user/footer') %>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/easyzoom@2.5.0/dist/easyzoom.js"></script>
<script>
  $(window).on('load', function() {
    var $easyzoom = $('.easyzoom').easyZoom();
    var api = $easyzoom.data('easyZoom');
    window.easyZoomInstance = api;
  });

  // Thumbnail switch
  function showImg(idx) {
    var images = document.querySelectorAll('.pd-thumb');
    var mainImg = document.getElementById('mainImage');
    var mainLink = document.getElementById('mainImageLink');
    images.forEach(function(img, i) {
      img.classList.toggle('active', i == idx);
      if(i === idx) {
        mainImg.src = img.src;
        mainLink.href = img.src;
        if(window.easyZoomInstance) window.easyZoomInstance.swap(img.src, img.src);
      }
    });
  }

  // Size pill click: update active capsule and price & stock
  var variantData = <%- JSON.stringify(product.variants || []) %>;
  function selectSize(size, idx) {
    $('.size-pill').removeClass('active');
    $('.size-pill').eq(idx).addClass('active');
    var variant = variantData.find(v => v.size === size);
    if (variant) {
      $('#salePrice').text(Number(variant.salePrice).toFixed(2));
      // Update stock button text and style
      if (variant.variantQuantity > 0) {
        $('#stockBtn').text('In Stock').attr('class', 'btn btn-primary').prop('disabled', true);
      } else {
        $('#stockBtn').text('Out of Stock').attr('class', 'btn btn-secondary').prop('disabled', true);
      }
    }
  }

  // Tab switching logic
  function switchTab(tab) {
    $('#productDetailsTab, #tab-details').toggleClass('active', tab==='details');
    $('#ratingsTab, #tab-reviews').toggleClass('active', tab==='reviews');
  }

  // Star rating
  $(document).on('mouseenter click', '.write-review-stars i', function() {
    var idx = parseInt($(this).data('star'));
    $('.write-review-stars i').each(function(i, el) {
      $(el).toggleClass('fas', i < idx).toggleClass('far', i >= idx);
    });
  });
  $(document).on('mouseleave', '.write-review-stars', function() {
    $('.write-review-stars i').removeClass('fas').addClass('far');
  });
</script>
</body>
</html>
